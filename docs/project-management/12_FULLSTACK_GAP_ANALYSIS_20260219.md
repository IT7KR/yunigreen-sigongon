# 시공ON 풀스택 종합 갭 분석 (v2.1)

> 작성일: 2026-02-19
> 기준 문서: `12_FULLSTACK_GAP_ANALYSIS_20260219.md` v2.0 정정본
> 정정 근거: 지정 회의/요청 문서 7건 + 코드베이스 실측 결과

---

## 0. 변경 요약 (v2.0 -> v2.1)

이번 v2.1은 v2.0의 사실 불일치를 수정한 정정본입니다.

1. 백엔드 집계 수치 정정
- v2.0의 라우터/서비스/모델 집계가 최신 코드보다 작게 기록되어 정정함.

2. 현장대리인 저장소 판정 정정
- `localStorage 기반` 경고를 삭제하고, 서버 영속화(DB/API) 구현 반영.

3. 프로젝트 탭 노출 상태 정정
- 문서함 탭은 실제 노출 상태로 수정.
- 워크플로우는 라우트 존재/탭 비노출로 분리 표기.

4. AI 신뢰도 표시 이슈 정밀화
- AI진단 상세 화면은 신뢰도 비노출(정책 반영).
- 케이스(Vision) 화면의 신뢰도 문구 잔존은 별도 정책 항목으로 분리.

5. AI 소견서 PDF 상태 정정
- 소견서 PDF 다운로드 API/생성기 구현 반영.
- 다만 사진 포함 레이아웃은 개선 과제로 재분류.

6. 외부연동 상태 표기 체계 변경
- `mock-only` 단일 표현을 폐기하고, `코드 준비` vs `운영 활성화`를 분리.

7. 데이터 격리 판정 보정
- 핵심 라우터의 `organization_id` 필터 적용 근거를 반영.
- 남은 리스크는 회귀 테스트 미흡으로 이동.

8. 동의 기록 저장 상태 정정
- Consent 모델/라우터 기반 서버 저장 구현 반영.

9. HWPX 템플릿 진행률 정정
- 시방서 1종만 완료가 아니라, 카테고리별 다수 `.hwpx` 템플릿 존재로 정정.

10. 로드맵 재정렬
- 이미 구현된 항목 제거.
- 운영 전환/검증 작업 중심으로 P0/P1 재구성.

---

## 1. 개요

### 1.1 프로젝트 정보

| 항목 | 내용 |
|------|------|
| 서비스명 | 시공ON |
| 발주사 | 유니그린개발 |
| 개발사 | IT7 |
| 분석 기준일 | 2026-02-19 |
| 기술스택 (백엔드) | FastAPI, PostgreSQL, pgvector, Gemini, ReportLab, HWPX 엔진 |
| 기술스택 (프론트) | Next.js 15, TypeScript, Tailwind, shadcn/ui, TanStack Query |
| 착수일 | 2026-01-19 |
| 목표 완료일 | 2026-05-30 |

### 1.2 분석 범위

- 요구사항 근거 문서(이번 정정 대상):
  - `docs/project-management/meeting/04_PRE_CONTRACT_MEETINGS.md`
  - `docs/project-management/meeting/20260121_meeting.md`
  - `docs/project-management/meeting/20260126_meeting.md`
  - `docs/project-management/meeting/20260202_meeting.md`
  - `docs/project-management/meeting/20260206_meeting.md`
  - `docs/project-management/request/20260202_daily_labor_report_request.txt`
  - `docs/project-management/request/20260202_email_request.txt`
- 교차 검증 기준:
  - 백엔드 실제 라우터 마운트 및 구현 코드
  - 프론트 실제 라우트 노출/비노출 상태
  - 기존 v2.0 문서의 주장과 실제 코드의 일치 여부

### 1.3 판정 기준 (v2.1)

`구현 상태`와 `운영 상태`를 분리합니다.

- 구현 상태:
  - `✅ 구현됨`: 코드/라우트/화면/모델 확인
  - `🟡 부분구현`: 일부만 구현 또는 정책/플로우 미완
  - `🔴 미구현`: 코드 근거 없음
- 운영 상태:
  - `🟢 운영 가능`: 실연동/실사용 가능
  - `🟠 설정 필요`: 코드 준비됨, 키/모드/계정 설정 필요
  - `⚪ 정책 미결`: 정책/요건 미확정으로 운영 불가

---

## 2. 요구사항 출처 문서 요약

| # | 문서 | 일자 | 핵심 상태 |
|---|------|------|----------|
| 1 | `04_PRE_CONTRACT_MEETINGS.md` | 2025-12-10~2026-01-08 | AI/RAG/견적자동화/전자서명/세금계산서/구독 모델 논의 |
| 2 | `20260121_meeting.md` | 2026-01-21 | 업무 15단계, 권한/가입 정보, 노무 신고 요구 |
| 3 | `20260126_meeting.md` | 2026-01-26 | 토스 확정, OTP 재설정, 적산 버전관리, 데이터 격리 |
| 4 | `20260202_meeting.md` | 2026-02-02 | 알림톡 초대 전환, 동의 기반 가입, 신고 엑셀 자동생성 |
| 5 | `20260206_meeting.md` | 2026-02-06 | 12탭, 현장대리인, AI 신뢰도 비노출, 세금계산서 연동처 검토 |
| 6 | `20260202_daily_labor_report_request.txt` | 2026-02-02 | 현장별/월통합 신고, 근복공단 양식 자동채움, 요율 변경 권한 |
| 7 | `20260202_email_request.txt` | 2026-02-02 | 공공데이터/알리고/토스 계정 및 코드값 확인 요청 |

---

## 3. 코드베이스 실측 현황 (2026-02-19)

### 3.1 백엔드 집계

| 항목 | 실측 값 | 근거 |
|------|--------|------|
| 라우터 파일 수 (`backend/app/routers/*.py`) | 24개 | `backend/app/routers` |
| `main.py` 실제 마운트 수 | 25개 | `backend/app/main.py` |
| 모델 파일 수 (`backend/app/models/*.py`) | 20개 | `backend/app/models` |
| 서비스 파일 수 (`backend/app/services/*.py`) | 20개 | `backend/app/services` |
| 서비스 Top-level 파일 수 (`__init__` 포함) | 16개 | `backend/app/services` |

### 3.2 v2.0 누락된 핵심 라우터 (현재는 구현됨)

| 라우터 | 상태 | 비고 |
|--------|------|------|
| `field_representatives.py` | ✅ | 현장대리인 CRUD/배정 API |
| `consent.py` | ✅ | 동의 기록 저장/조회 |
| `documents.py` | ✅ | HWPX 템플릿 목록/생성 |
| `notifications.py` | ✅ | 알림톡/SMS 발송 API |
| `dashboard.py` | ✅ | 대시보드 데이터 API |

### 3.3 외부연동 운영 준비도 (정정본)

| 서비스 | 코드 준비 | 기본 런타임 모드 | 운영 준비도 | 근거 |
|--------|----------|-----------------|------------|------|
| Gemini | ✅ | 실연동 | 🟢 운영 가능 | `backend/app/core/ai.py` |
| 알리고 (SMS/알림톡) | ✅ (Mock+Real 클래스) | `aligo_is_mock=true` 기본 | 🟠 설정 필요 | `backend/app/services/sms.py`, `backend/app/core/config.py` |
| 토스페이먼츠 | ✅ (Mock+Real 클래스) | `toss_is_mock=true` 기본 | 🟠 설정 필요 | `backend/app/services/billing_service.py`, `backend/app/core/config.py` |
| 모두싸인 | ✅ (Mock+Real 클래스) | `modusign_is_mock=true` 기본 | 🟠 설정 필요 | `backend/app/services/modusign_service.py`, `backend/app/core/config.py` |
| 팝빌 | ✅ (Mock+Real 어댑터) | `popbill_is_mock=true` 기본 | 🟠 설정 필요 | `backend/app/services/popbill_service.py`, `backend/app/core/config.py` |
| 공공데이터 사업자검증 | ✅ (Mock+Real 서비스) | `business_verification_is_mock=true` 기본 | 🟠 설정 필요 | `backend/app/services/business_verification.py`, `backend/app/core/config.py` |

### 3.4 HWPX 템플릿 현황 (정정)

`sample` 기준 `.hwpx` 파일 실측:

| 카테고리 | 경로 | `.hwpx` 수 |
|----------|------|-----------:|
| generated | `sample/generated` | 16 |
| contract | `sample/1. 관공서 계약서류` | 3 |
| start | `sample/2. 관공서 착공서류` | 8 |
| completion | `sample/3. 관공서 준공서류` | 5 |
| school | `sample/9. 학교 서류` | 1 |
| 합계 | - | 33 |

v2.0의 "시방서 1종만 완료" 판정은 최신 코드/샘플 기준에서 사실이 아닙니다.

---

## 4. v2.0 핵심 오판 정정표

| # | v2.0 주장 | v2.1 정정 | 영향 |
|---|-----------|-----------|------|
| 1 | 라우터/서비스 집계가 21/14 수준 | 실제는 라우터 파일 24, 마운트 25, 서비스 파일 20 | 전체 우선순위 왜곡 방지 |
| 2 | 현장대리인 localStorage 저장 | 서버 DB/API 영속화 구현됨 | P0 항목 재분류 |
| 3 | 문서함 탭 비노출 | 문서함 탭 노출됨 | 프로젝트 탭 분석 정정 |
| 4 | AI 신뢰도 배지 잔존(진단) | 진단 상세는 비노출, 케이스 화면은 별도 | 정책 항목 분리 |
| 5 | AI 소견서 PDF 미완 | 다운로드 API/생성기 구현 | 잔여 과제 범위 축소 |
| 6 | 외부연동 mock-only | 실연동 클래스 존재, 기본 설정이 mock | 운영 전환 과제로 이동 |
| 7 | 데이터 격리 미확인 | 핵심 라우터에 `organization_id` 필터 다수 적용 | 리스크 성격 변경 |
| 8 | 동의 기록 서버 저장 미확인 | Consent 모델/라우터 구현됨 | 법적 증빙 로드맵 조정 |
| 9 | HWPX 템플릿 대다수 미생성 | 카테고리별 다수 `.hwpx` 존재 | P0 블로커 해소 |
| 10 | P0에 이미 구현 항목 포함 | 운영 전환/회귀 검증 중심으로 재정렬 | 실행계획 현실화 |

---

## 5. 도메인별 상세 갭 분석 (정정본)

### 5.1 AI 진단

**현황**
- `Gemini 3.0 -> 2.0 -> 1.5 -> manual` 폴백 체인 구현.
- JSON 응답 강제(`application/json`) 적용.
- AI 진단 상세 화면에 현장 소견(수기) 저장 구현.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 음성 입력 -> 항목 선택 | 🔴 | ⚪ | 모바일 편의 기능 미구현 |
| 안전관리 사진 인식(모자/안전화) | 🔴 | ⚪ | 모델/룰 미구현 |
| AI 신뢰도 비노출 정책 | 🟡 | ⚪ | 진단 화면은 반영, 케이스(Vision) 화면 문구 잔존 |
| 진단 이미지 수량 규격 | 🔴 | ⚪ | 비용 정책 미결 |
| AI 소견서 PDF (사진+설명) | 🟡 | 🟠 | 텍스트 기반 PDF는 구현, 사진 삽입 레이아웃 보강 필요 |

### 5.2 적산/견적

**현황**
- PDF 업로드/파싱/버전관리/활성화 흐름 구현.
- 금액 계산은 `EstimationService`에서 RDB 기반 수행(AI 계산 배제).

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| SA 전용 업로드 권한 | ✅ | 🟢 | 관리자 의존성 적용 |
| 파싱 검증 리포트 고도화 | 🟡 | 🟠 | 기본 리포트/스테이징은 있으나 품질 지표 강화 필요 |
| 적산 품질 회귀 테스트 | 🔴 | ⚪ | 버전 업데이트 시 회귀체계 미흡 |

### 5.3 계약/서명

**현황**
- 공사계약/근로계약 도메인 API 및 UI 구현.
- 모두싸인/자체서명 플로우 코드 존재.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 모두싸인 실운영 전환 | 🟡 | 🟠 | `modusign_is_mock` 해제 및 키 적용 필요 |
| 서명 완료 문서 보관/감사 추적 | 🟡 | 🟠 | 운영 로그/감사 추적 규격 필요 |

### 5.4 시공/준공/문서 생성

**현황**
- 착공/준공 리포트, 앨범, 문서 라우트 구현.
- HWPX 템플릿 엔진 및 다수 템플릿 파일 존재.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 착공서류 체크리스트-현장대리인 자동연동 | 🟡 | ⚪ | 배정 데이터는 있으나 체크리스트 자동 바인딩 미완 |
| 템플릿별 context 표준 스키마 | 🟡 | 🟠 | 문서 유형별 입력 schema 정규화 필요 |
| 학교 `.xlsm` 매크로 서식 전략 | 🔴 | ⚪ | 보존/변환 정책 미결 |

### 5.5 노무/신고

**현황**
- 근로자/근무기록/계약/급여 계산/엑셀 출력 구조 구현.
- 보험요율 관리 API/화면 구현.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 근복공단 코드값(국적/체류/직종) 매핑 | 🟡 | ⚪ | 발주사 코드 확정 필요 |
| 근로자 서류 미등록 시 투입 제한 | 🔴 | ⚪ | 강제 검증 로직 미완 |
| 지급명세 수령확인 운영 완결 | 🟡 | 🟠 | 알림 연동/상태 추적 보강 필요 |
| 월별 통합/현장별 양식 정합 검증 | 🟡 | ⚪ | 샘플 양식 대조 자동테스트 필요 |

### 5.6 권한/데이터 격리/동의

**현황**
- 주요 도메인 라우터에 조직 필터 적용.
- 동의 기록 서버 저장 API 구현.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 테넌트 격리 회귀 테스트 스위트 | 🔴 | ⚪ | 코드 적용은 있으나 자동 검증 부족 |
| 프로젝트 단위 가시성 정책 점검 | 🟡 | ⚪ | 화면/쿼리 동시 검증 필요 |
| 동의 증빙(감사 로그/보관 정책) 강화 | 🟡 | 🟠 | 저장은 구현, 감사 체계 보강 필요 |

### 5.7 프로젝트 탭/IA

**현황**
- 12개 핵심 탭은 구현 및 노출.
- 문서함 탭은 추가 노출 상태.
- 워크플로우 페이지는 라우트 존재, 탭 비노출.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 워크플로우 탭 노출 정책 확정 | 🔴 | ⚪ | v1 포함 여부 미결 |
| 문서함 IA 정식화 | 🟡 | ⚪ | 임시/정식 분류 정책 필요 |

### 5.8 결제/세금계산서

**현황**
- 토스 결제 API/빌링키/구독 로직 구현.
- 세금계산서 도메인 및 팝빌 어댑터 구현.

**갭**
| 항목 | 구현 상태 | 운영 상태 | 메모 |
|------|----------|----------|------|
| 토스 운영 키/웹훅/정기결제 운영전환 | 🟡 | 🟠 | 설정/운영 검증 필요 |
| 팝빌 실운영 발행 연동 검증 | 🟡 | 🟠 | 테스트 시나리오 및 계정 설정 필요 |
| 세금계산서 연동처 최종 확정(팝빌 vs 토스) | 🔴 | ⚪ | 비즈니스 결정 필요 |

---

## 6. 핵심 비즈니스 규칙 정합성 (정정)

| 규칙 | 상태 | 비고 |
|------|------|------|
| 단가 계산은 RDB only | ✅ | `EstimationService`에서 단가/합계 계산 |
| AI는 분석/추천 중심, 계산 배제 | ✅ | `DiagnosisService` 주석/구조 반영 |
| AI 응답 JSON 강제 | ✅ | Gemini 호출 시 `response_mime_type` 적용 |
| Gemini 폴백 체인 | ✅ | 3.0 -> 2.0 -> 1.5 -> manual |
| 동의 기록 서버 저장 | ✅ | Consent 모델/라우터 구현 |
| 테넌트 격리 | 🟡 | 코드 필터 적용, 회귀 테스트 미흡 |
| 현장대리인 1프로젝트 1명 | ✅ | assignment unique 구조 반영 |
| AI 신뢰도 비노출 정책 | 🟡 | 진단 화면 반영, 케이스 화면 추가 조정 필요 |

---

## 7. 미결 사항 (Open Issues)

| # | 미결 사항 | 도메인 | 필요 시점 |
|---|----------|--------|----------|
| 1 | 세금계산서 최종 연동처 확정(팝빌/토스) | TAX | 즉시 |
| 2 | 알리고 발신프로필/채널명 최종 확정 | NOTI | 즉시 |
| 3 | 근복공단 코드값(국적/체류/직종) 회신 | LAB | 즉시 |
| 4 | AI 진단 이미지 최대 등록 개수 정책 | AI | 개발 전 |
| 5 | 워크플로우 탭 v1 포함 여부 | IA | 범위 확정 시 |
| 6 | 날씨 연동 방식 최종 확정(API/수기) | CONSTRUCTION | v0.3 이전 |
| 7 | 학교 `.xlsm` 처리 전략 | DOC | 1차 릴리즈 전 |
| 8 | 인프라(클라우드/온프레미스) 확정 | DEVOPS | 릴리즈 전 |

---

## 8. 우선순위별 실행 로드맵 (정정본)

### P0 - 운영 전환 차단 이슈

| # | 항목 | 도메인 | 예상 공수 |
|---|------|--------|---------:|
| P0-1 | 알리고 운영 전환 (키/발신프로필/실발송 검증) | NOTI | 3일 |
| P0-2 | 토스 운영 전환 (키/웹훅/빌링키 실결제 검증) | PAY | 5일 |
| P0-3 | 모두싸인 운영 전환 (키/콜백/서명 완료 다운로드 검증) | CONTRACT | 5일 |
| P0-4 | 테넌트 격리 회귀 테스트 스위트 구축 | SECURITY | 3일 |
| P0-5 | 팝빌 운영 전환 또는 연동처 최종 전환 결정 | TAX | 4일 |

### P1 - 1차 릴리즈 필수

| # | 항목 | 도메인 | 예상 공수 |
|---|------|--------|---------:|
| P1-1 | 근복공단/국세청 양식 정합성 자동 검증 + 코드 매핑 | LAB | 5일 |
| P1-2 | 근로자 서류 미등록 투입 제한 룰 구현 | LAB | 2일 |
| P1-3 | 착공 체크리스트-현장대리인 서류 자동 연동 | CONSTRUCTION | 3일 |
| P1-4 | AI 소견서 PDF 사진 포함 템플릿 개선 | AI/DOC | 3일 |
| P1-5 | 케이스(Vision) 화면 신뢰도 문구 정책 정리/반영 | AI/UX | 1일 |
| P1-6 | 동의/초대/알림 도메인 감사로그 보강 | COMPLIANCE | 2일 |

### P2 - 2차 릴리즈

| # | 항목 | 도메인 | 예상 공수 |
|---|------|--------|---------:|
| P2-1 | 음성 입력 -> 텍스트 -> 항목 선택 | AI/MOBILE | 5일 |
| P2-2 | 안전관리 사진 인식(모자/안전화) | AI | 5일 |
| P2-3 | 사진 중복 제거(유사도) | PHOTO | 5일 |
| P2-4 | 워크플로우 탭 노출/정보구조 확정 | IA | 3일 |
| P2-5 | 학교 `.xlsm` 지원 전략 반영 | DOC | 3일 |

---

## 9. 문서 표기 규칙 (v2.1부터 적용)

1. 외부연동은 `구현`과 `운영`을 분리 표기한다.
2. `미확인` 표현은 금지하고, 반드시 다음 중 하나로 표기한다.
- `코드 확인됨, 테스트 미완`
- `정책 미결`
- `근거 없음(미구현)`
3. 집계 수치(파일/라우터/마운트)는 본문과 부록에서 동일해야 한다.
4. 우선순위 로드맵에는 `이미 구현된 항목`을 넣지 않는다.

---

## 10. 부록

### 부록 A: 최신 백엔드 라우터 파일 목록 (24)

`auth.py`, `users.py`, `projects.py`, `site_visits.py`, `diagnoses.py`, `estimates.py`, `pricebooks.py`, `rag.py`, `cases.py`, `contracts.py`, `labor_contracts.py`, `materials.py`, `photo_albums.py`, `construction_reports.py`, `billing.py`, `tax_invoices.py`, `operations.py`, `harness.py`, `field_representatives.py`, `consent.py`, `documents.py`, `notifications.py`, `dashboard.py`, `__init__.py`

### 부록 B: `main.py` 마운트 목록 (25)

중복 분리 마운트 포함:
- 계약: `contracts_router`, `project_contracts_router`
- 노무: `labor_contracts_router`, `project_labor_router`

그 외 `field_representatives`, `consent`, `documents`, `notifications`, `dashboard` 포함.

### 부록 C: 즉시 검증 체크리스트

1. `.env`에서 `*_is_mock=false` 전환 후 스모크 테스트
2. 알리고 실발송(초대/OTP/재초대) 검증
3. 토스 결제 승인/빌링키/웹훅 검증
4. 모두싸인 요청/상태/다운로드 검증
5. 팝빌 발행/취소/팝업 URL 검증
6. 조직 간 데이터 접근 회귀 테스트
7. 근복공단/국세청 샘플 엑셀 정합성 비교 테스트

---

## 결론

v2.0의 핵심 문제는 "미구현"과 "운영 미활성"을 혼동한 데 있습니다.
v2.1에서는 코드 구현 상태를 사실대로 복원하고, 실제 차단 이슈를 **운영 전환/정책 확정/검증 자동화**로 재정의했습니다.
