# HWPX 문서 자동생성 운영 가이드

> 목적: 프로젝트 상태/문서 종류에 따라 어떤 HWPX 문서를 언제 생성해야 하는지, 그리고 템플릿 기반 자동생성을 어떻게 운영해야 하는지 실행 기준을 정의합니다.

**최초 작성**: 2026-02-06  
**기준 문서**:
- `docs/project-management/08_DOCUMENT_REQUIREMENTS_MATRIX.md`
- `docs/project-management/05_DOCUMENT_WORKFLOW.md`
- `docs/project-management/09_HWPX_TEMPLATE_ENGINE_GUIDE.md`
- `docs/project-management/07_MEETING_DECISIONS_SUMMARY.md`

---

## 1. 적용 범위

이 가이드는 다음에 적용합니다.

1. 한글 양식 문서(HWP/HWPX) 생성이 필요한 모든 케이스
2. `TPL`(템플릿 기반 생성) 분류 문서
3. `AUTO` 문서 중 최종 산출 형식이 HWPX인 문서

적용 제외:

1. 순수 `UPLOAD` 문서(사용자 첨부 원본)
2. `EXT` 문서(외부 서비스가 원본 생성)

---

## 2. 판단 순서: 어떤 경우에 어떤 문서가 필요한가

문서 생성 판단은 아래 순서로 고정합니다.

| 단계 | 판단 항목 | 기준 문서 | 결과 |
|---|---|---|---|
| 1 | 프로젝트 유형 확인 | `08_DOCUMENT_REQUIREMENTS_MATRIX.md` | 공공/민간/학교/노무신고 케이스 확정 |
| 2 | 프로젝트 상태 확인 | `05_DOCUMENT_WORKFLOW.md` | 계약/착공/시공/준공/하자보수 단계 확정 |
| 3 | 문서 의무 여부 확인 | `08_DOCUMENT_REQUIREMENTS_MATRIX.md` | 필수/조건부/권장 분류 |
| 4 | 생성 방식 확인 | `AUTO`/`TPL`/`UPLOAD`/`EXT` | 시스템 생성 여부 확정 |
| 5 | 출력 형식 확인 | HWPX 우선 정책 | HWP/HWPX 생성 또는 타 형식 분기 |

핵심 원칙:

1. 한글 문서는 HWPX(HWP) 직접 생성이 기본입니다.
2. PDF는 열람/배포용 보조 형식으로만 사용합니다.
3. 조건부 문서는 트리거(발주처 요구, 금액 기준, 학교 발주 여부)가 충족될 때만 생성합니다.

---

## 3. 문서 생성 방식별 처리 규칙

| 분류 | 처리 규칙 | 예시 |
|---|---|---|
| `AUTO` | DB 기반으로 즉시 생성. 계산은 RDB 로직만 사용 | 견적내역서, 준공내역서 |
| `TPL` | HWPX 템플릿 + 컨텍스트 데이터로 렌더링 | 착공공문, 준공계, 시방서 |
| `UPLOAD` | 생성하지 않고 업로드/버전관리만 수행 | 보증서, 계획서 |
| `EXT` | 외부 API 결과를 저장/연계 | 전자서명 계약서 |

`TPL` 문서는 반드시 본 가이드의 4~8장을 따릅니다.

---

## 4. HWPX 템플릿 설계 규칙

## 4.1 토큰 규칙

지원 토큰 문법:

```text
{{project_name}}
{{site_address}}
{{#scope_items}}{{index}}) {{item}}{{separator}}{{/scope_items}}
```

세부 규칙:

1. 토큰 키는 소문자 스네이크 케이스를 권장합니다.
2. 중첩 객체는 점 표기(`{{contract.owner_name}}`)를 사용합니다.
3. 반복 블록은 인라인 루프 또는 문단 루프를 사용합니다.
4. 토큰 문구는 사람용 기본 문구와 겹치지 않게 명확히 작성합니다.

## 4.2 템플릿 작성 규칙

1. 하드코딩 고정값 대신 토큰을 삽입합니다.
2. 블록 루프 시작/종료 마커는 문단 전체를 마커로 둡니다.
3. 템플릿 파일은 HWPX 원본을 보존하고 파생본을 분리 관리합니다.
4. 템플릿별 필수 토큰 목록을 문서화합니다.
5. 렌더링은 `strict` 모드로 수행합니다.

---

## 5. 템플릿 등록 절차 (신규 샘플 onboarding)

신규 HWPX 샘플이 들어오면 아래 절차를 고정 실행합니다.

| 순서 | 작업 | 산출물 |
|---|---|---|
| 1 | 샘플 문서 분류(문서군/단계/필수여부) | 문서 분류 메모 |
| 2 | 기준 템플릿 1종 선정(가장 재사용성 높은 양식) | 기준 템플릿 ID |
| 3 | 토큰 삽입(고정 문구를 변수화) | 토큰 템플릿 HWPX |
| 4 | 필수 컨텍스트 스키마 정의 | 토큰 사전(JSON/YAML 또는 문서 표) |
| 5 | 샘플 데이터로 렌더링 | 생성 HWPX |
| 6 | QA 체크리스트 검수 | 검수 결과 |
| 7 | 운영 등록(버전 태그) | 템플릿 버전 기록 |

권장 템플릿 ID 규칙:

```text
<문서군>_<발주유형>_<버전>
예) SPEC_PUBLIC_V1, START_NOTICE_PUBLIC_V1, COMPLETION_REPORT_PUBLIC_V1
```

---

## 6. 데이터 컨텍스트 작성 규칙

## 6.1 공통 필드

| 필드 | 타입 | 설명 |
|---|---|---|
| `project_name` | string | 공사명 |
| `site_address` | string | 공사 위치 |
| `owner_name` | string | 발주처/건물주 |
| `contractor_name` | string | 시공사명 |
| `duration_days` | number | 공사 기간(일) |

## 6.2 반복 필드

| 필드 | 타입 | 설명 |
|---|---|---|
| `scope_items` | string[] | 공사 범위 목록 |
| `workers` | object[] | 근로자 목록 |
| `materials` | object[] | 자재 목록 |

예시:

```json
{
  "project_name": "서초고등학교 누수 부분 방수공사",
  "site_address": "서울 서초구 반포대로27길 29 서초고등학교",
  "duration_days": 21,
  "scope_items": [
    "균열 보수",
    "우레탄도막방수",
    "창틀 보수 방수",
    "실리콘 코킹 보강"
  ]
}
```

---

## 7. 렌더링 실행 기준

현재 기준 실행 경로:

- 엔진: `backend/app/services/hwpx_template_engine.py`
- 샘플 PoC: `backend/scripts/hwpx_spec_template_demo.py`

실행 예시:

```bash
python3 backend/scripts/hwpx_spec_template_demo.py \
  --template-source "sample/샘플시방서_(주)유니그린개발.hwpx" \
  --token-template "sample/generated/시방서_토큰템플릿.hwpx" \
  --output "sample/generated/시방서_자동생성_샘플.hwpx" \
  --project-name "서초고등학교 누수 부분 방수공사" \
  --site-address "서울 서초구 반포대로27길 29 서초고등학교" \
  --duration-days 21 \
  --scope "균열 보수" \
  --scope "우레탄도막방수" \
  --scope "창틀 보수 방수" \
  --scope "실리콘 코킹 보강" \
  --strict
```

운영 규칙:

1. 운영 배치/API는 기본 `strict=true`로 실행합니다.
2. 미해결 토큰 발생 시 문서 생성 실패로 처리합니다.
3. 실패 문서는 사용자에게 재입력 또는 템플릿 점검 액션을 안내합니다.

---

## 8. 품질 검수 체크리스트

생성 문서는 아래 항목을 모두 통과해야 배포합니다.

1. HWPX 내부에 `{{`/`}}` 토큰 잔존이 없어야 함
2. 필수 문구(공사명/위치/기간/금액 등) 치환 완료
3. 반복 항목 개수와 출력 줄 수가 일치
4. 한컴오피스에서 열림/인쇄 이상 없음
5. 프로젝트 단계의 필수 문서 세트가 누락되지 않음

---

## 9. 다중 템플릿 대응 전략 (replace 방식 보완)

문자열 단순 `replace`만으로는 여러 양식을 안정적으로 처리하기 어렵습니다.  
운영 기준은 아래와 같습니다.

1. 공통 엔진은 토큰/루프 방식으로 유지합니다.
2. 템플릿별 차이는 “토큰 사전 + 템플릿 ID”로 분리합니다.
3. 샘플별 변환 규칙은 문서군 단위(시방서/착공공문/준공계)로 관리합니다.
4. 신규 양식 추가 시 엔진 수정보다 템플릿/토큰 사전 확장을 우선합니다.

즉, 엔진은 1개를 유지하고 템플릿 자산만 늘리는 구조로 운영합니다.

---

## 10. 역할과 책임

| 역할 | 책임 |
|---|---|
| 기획/운영 | 문서 필수 여부, 제출처 요구 형식 확정 |
| 템플릿 담당 | HWPX 양식 정비, 토큰 삽입, 버전 관리 |
| 백엔드 | 렌더링 API/배치, strict 검증, 실패 처리 |
| QA | 샘플 회귀 테스트, 출력 검증 |

---

## 11. 즉시 실행 ToDo

1. 문서군별 템플릿 ID 목록 작성(시방서/착공공문/준공계)
2. 템플릿별 필수 토큰 사전 정의
3. 템플릿 등록 시 자동 검수 스크립트 추가
4. 프로젝트 단계 전환 시 필수 문서 누락 검사 로직 추가

